<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="description"content="Basic Phonegap App generated by MyEclipse Mobile Tools" />
<title>Basic PhoneGap Application</title>
    <script type="text/javascript" src="cordova.js"></script>
	<script type="text/javascript" src="js/phonegap.facebook.inappbrowser.js"></script>
</head>
<body>
	<div id="fb-root"></div>
<script type="text/javascript" charset="utf-8">
            window.fbAsyncInit = function() 
            {
            			//	alert(document.URL);
                          FB.init({
                            appId      : 1516434941703425,
                            status     : true, // check login status
                            cookie     : true, // enable cookies to allow the server to access the session
                            xfbml      : true  // parse XFBML
                          });

                          function getJsonFromUrl(urlString) 
                          {
                              var parameterQuery = urlString.split("?");
                              var data = parameterQuery[1].split("&");
                              var result = {};
                              
                              for(var i=0; i<data.length; i++) 
                              {
                                var item = data[i].split("=");
                                result[item[0]] = decodeURIComponent(item[1]);
                              }
                              return result;
                           }

                          var fbDataArray = getJsonFromUrl(document.URL);   

                          //If user cancels the permission page
                          if (typeof  fbDataArray['error'] !== "undefined") 
                          {
                            location = "http://YOUR_DOMAIN/setVars.html?name=" + response.name + "&email=" + response.email + "&id=" + response.id;
                          }

                          FB.Event.subscribe('auth.authResponseChange', function(response) 
                          {
							//alert(response.status);
                            // Here we specify what we do with the response anytime this event occurs. 
                            if (response.status === 'connected') 
                            {
                              // The response object is returned with a status field that lets the app know the current
                              // login status of the person. In this case, we're handling the situation where they 
                              // have logged in to the app.
                              getFBdata();
                            } 
                            else if (response.status === 'not_authorized') 
                            {
                              // In this case, the person is logged into Facebook, but not into the app
                              //FB.login();
                              //location = "http://YOUR_DOMAIN/setVars.html?name=" + response.name + "&email=" + response.email + "&id=" + response.id;
                            } 
                            else
                            {
                              // In this case, the person is not logged into Facebook,
                              //FB.login();
                              //location = "http://YOUR_DOMAIN/setVars.html?name=" + response.name + "&email=" + response.email + "&id=" + response.id;
                            }
                          });
              };

              // Load the SDK asynchronously
              (function(d)
              {
               var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
               if (d.getElementById(id)) {return;}
               js = d.createElement('script'); js.id = id; js.async = true;
               js.src = "https://connect.facebook.net/en_US/all.js";
               ref.parentNode.insertBefore(js, ref);
              }
              (document));

              // Here we run a very simple test of the Graph API after login is successful. 
              // This testAPI() function is only called in those cases. 
              function getFBdata() 
              {

                FB.api('/me', {fields: 'name,email,id'}, function(response)
                {
                  //alert(response.name + " email=" + response.email + " id=" + response.id);
                  location = "http://localhost:9090/setVars.html?name=" + response.name + "&email=" + response.email + "&id=" + response.id;
                  //alert('going');
                });

              }
    </script>
</body>
</html>